services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: pest_detection
      MYSQL_USER: pest_user
      MYSQL_PASSWORD: password
    ports: ["3306:3306"]
    volumes: [ "mysql_data:/var/lib/mysql" ]
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    command: ["redis-server","--appendonly","yes"]
    ports: ["6379:6379"]
    volumes: [ "redis_data:/data" ]
    restart: unless-stopped

  minio:
    image: minio/minio:latest
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    ports: ["9000:9000","9001:9001"]
    volumes: [ "minio_data:/data" ]
    restart: unless-stopped

  # Kafka 兼容，开发期用 redpanda 单节点
  redpanda:
    image: redpandadata/redpanda:latest
    command:
      - redpanda start
      - --overprovisioned
      - --smp 1
      - --memory 1G
      - --reserve-memory 0M
      - --check=false
    ports: ["9092:9092","9644:9644"]
    volumes: [ "redpanda_data:/var/lib/redpanda/data" ]
    restart: unless-stopped

volumes:
  mysql_data:
  redis_data:
  minio_data:
  redpanda_data:
